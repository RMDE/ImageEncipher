# 基于差分扩展的缩略图保持加密技术
## 环境配置
- matlab
##	基本原理
- 以块为单位，将块分为调整区和嵌入区，利用差分扩展将调整区中的像素的MSB嵌入嵌入区，加密后通过改变调整区像素的MSB使块平均像素与原始平均像素值基本一致从而达到缩略图保持。
## 应用场景
- 云端的图片保存等
## 具体步骤
###	一.腾空间
1. 记录调整区的MSB
2. 对嵌入区的像素进行分类
   - 每两个像素为一组
   - 计算两个像素之间的平均值以及差值
      - l = [x+y]/2    
      - h = x-y
   - 通过判断 |2*h+b| , |2*[h/2]+b| 与 min(2(255-l),2l+1) 之间的关系，从而对每组像素进行分类
      - EZ ：h=0 || h=-1
      - EN : |2*h+b| <= min(2(255-l), 2l+1)    即可拓展集合
      - CN : |2*[h/2]+b| <= min(2(255-l), 2l+1    即可变集合
      - NC : 不满足上述两个条件，即不可变区
   - 考虑到空间因素，将EN分为EN1和EN2两部分一部分作为可拓展部分，一部分作为可变部分
3. 生成待嵌入数据
   - locate-map用于标记可拓展像素组
   - 对属于EN2和CN集合的像素组的h的LSB部分进行收集(h=1 || h=-2时不用记录)
   - 调整区的MSB部分
4. 进行数据嵌入
   - 对于可拓展像素组
      - h' = 2*h+b  (b为待嵌入比特)
   - 对于可变像素组
      - h' = 2*[h/2]+b
   - x' = l+[(h'+1)/2]      
   - y' = l-[h'/2]
### 二.加密
- 此处用简单的流加密方式进行加密，当然可以采用更安全的加密方式（包括会改变像素位置的加密方式，但一定要记录可调整区像素位置用于调整）
### 三.调整
- 通过不断改变调整区像素的MSB，找出所有可能中最接近于原图像块平均像素的一组数据
### 四.解密
- 此处和加密一致，直接将加密过程用于解密即可
### 五.提取
1. 将嵌入区的像素组分类
   - 两个像素一组
   - 计算两个像素之间的平均值以及差值
      - l = [x+y]/2    
      - hh = x-y
   - 通过判断 |2*[h/2]+b| 与 min(2(255-l),2l+1) 之间的关系，从而对每组像素进行分类
      - CH ：|2*[h/2]+b| <= min(2(255-l), 2l+1 即可变集合
      - NC ：不可变区
2. 可变集合CH中的hh的LSB位即为嵌入的信息
3. 对提取信息进行操作，利用先前设定的分界符取出locate-map
4. 对嵌入区的像素进行还原
   - 对于属于EZ & EN1的像素组（即locate-map中值为1）： h = [hh/2]
   - 0 <= hh <= 1:  h = 1
   - 12 <= hh <= -1:  h = -2
   - else:  h = 2*[hh/2]+LSB
   - x = l+[(h+1)/2]
   - y = l-[h/2]
5. 对调整区像素进行还原
   - pixel = pixel(8-MSB)+MSB